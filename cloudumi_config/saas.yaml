# When running this locally, ensure your /etc/hosts file has the following configuration:
# 127.0.0.1 localhost redis-cluster cloudumi-dynamodb cloudumi-redis localstack1 localstack2 localstack3
# TODO: Extends must NOT modify _global_. It must ONLY exist in the site_config specific namespace
extends:
  - saas_localhost.yaml
  - saas_oidc_cloudumi_com.yaml
  - saas_saml_cloudumi_com.yaml
  - saas_auth0_cloudumi_com.yaml
  - saas_aws_sso_cloudumi_com.yaml
  - saas_cognito_cloudumi_com.yaml
_global_:
  elastic_apn:
    enabled: true
    service_name: cloudumi
    server_url: http://apmserver:8200
  logging:
    file: /logs/cloudumi/cloudumi_tornado.log
  sentry:
    dsn: http://c431e275be51424e98734f222cca6c47@sentry.cloudumi.com:9000/1
  boto3:
    client_kwargs:
      # http://localhost:4568
      endpoint_url: http://localstack3:4566
    session_kwargs:
      profile_name: localstack
  config:
    load_from_dynamo: false
    automatically_reload_configuration: true
  consoleme_s3_bucket: consolemecache
  # TODO: Remove in Prod
  # http://localhost:8005
  dynamodb_server: http://cloudumi-dynamodb:8005
  environment: dev
  development: true
  tornado:
    debug: true
    port: 8081
    xsrf: false
    xsrf_cookie_kwargs:
      samesite: strict
  plugins:
    auth: cmsaas_auth
    aws: cmsaas_aws
    group_mapping: cmsaas_group_mapping
    internal_celery_tasks: cmsaas_celery_tasks
    metrics: cmsaas_metrics
    internal_config: cmsaas_config
    internal_routes: cmsaas_internal_routes
    internal_policies: cmsaas_policies
  celery:
    broker:
      us-east-1: redis://cloudumi-redis:6379/1
      us-west-2: redis://cloudumi-redis:6379/1
      global: redis://cloudumi-redis:6379/1
    backend:
      us-east-1: redis://cloudumi-redis:6379/2
      us-west-2: redis://cloudumi-redis:6379/2
      global: redis://cloudumi-redis:6379/2
    debug: true
  # Saas Configuration
  redis:
    cluster_mode:
      enabled: true
      nodes:
        global:
          - host: redis-cluster
            port: "7000"
          - host: redis-cluster
            port: "7001"
          - host: redis-cluster
            port: "7002"
          - host: redis-cluster
            port: "7003"
          - host: redis-cluster
            port: "7004"
          - host: redis-cluster
            port: "7005"
# Localhost configuration
#  redis:
#    cluster_mode:
#      enabled: true
#      nodes:
#        - host: 127.0.0.1
#          port: "7000"
#        - host: 127.0.0.1
#          port: "7001"
#        - host: 127.0.0.1
#          port: "7002"
#        - host: 127.0.0.1
#          port: "7003"
#        - host: 127.0.0.1
#          port: "7004"
#        - host: 127.0.0.1
#          port: "7005"
# TBD: Celery Redis configuration
