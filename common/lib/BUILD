load("@rules_python//python:defs.bzl", "py_library")
load("@rules_python//python:packaging.bzl", "py_wheel")
load("@cloudumi_python_ext//:requirements.bzl", "requirement")

INT_DEPS = [
    "//plugins:lib",
    "//util/log:lib",
]

EXT_DEPS = [
    requirement("aiofiles"),
    requirement("aiopath"),
    requirement("aiozipkin"),
    requirement("asgiref"),
    requirement("bcrypt"),
    requirement("blinker"),
    requirement("boto"),
    requirement("boto3"),
    requirement("botocore"),
    requirement("click"),
    requirement("cloudaux"),
    requirement("cryptography"),
    requirement("deepdiff"),
    requirement("ed25519"),
    requirement("furl"),
    requirement("gitpython"),
    requirement("PyGithub"),
    requirement("google-api-python-client"),
    requirement("Jinja2"),
    requirement("joblib"),
    requirement("jsonschema"),
    requirement("marshmallow"),
    requirement("okta"),
    requirement("okta-jwt"),
    requirement("onelogin"),
    requirement("pandas"),
    requirement("parliament"),
    requirement("password_strength"),
    requirement("policy_sentry"),
    requirement("pydantic"),
    requirement("pyjwt"),
    requirement("pynamodax"),
    requirement("pytz"),
    requirement("python3-saml"),
    requirement("redis"),
    requirement("requests"),
    requirement("retrying"),
    requirement("ruamel.yaml"),
    requirement("sentry_sdk"),
    requirement("simplejson"),
    requirement("tenacity"),
    requirement("tornado"),
    requirement("ujson"),
    requirement("validate_email"),
]

REQUIRES = [
    "aiofiles",
    "aiopath",
    "aiozipkin",
    "asgiref",
    "bcrypt",
    "blinker",
    "boto",
    "boto3",
    "botocore",
    "click",
    "cloudaux",
    "cryptography",
    "deepdiff",
    "ed25519",
    "furl",
    "gitpython",
    "google-api-python-client",
    "Jinja2",
    "joblib",
    "jsonschema",
    "marshmallow",
    "okta",
    "okta-jwt",
    "onelogin",
    "pandas",
    "parliament",
    "password_strength",
    "policy_sentry",
    "pydantic",
    "PyGithub",
    "pyjwt",
    "python3-saml",
    "pytz",
    "redis",
    "requests",
    "retrying",
    "ruamel.yaml",
    "sentry_sdk",
    "simplejson",
    "tenacity",
    "tornado",
    "ujson",
    "validate_email",
]

filegroup(
    name = "src_files",
    srcs = glob([
        "**/*.py"
    ]),
    visibility = ["//visibility:public"],
)

py_library(
    name = "lib",
    data = [],
    srcs_version = "PY3",
    srcs = [
        ":src_files",
        "//common:models.py",
    ],
    deps = INT_DEPS + EXT_DEPS,
    visibility = ["//visibility:public"],
)

py_wheel(
    name = "py_wheel",
    distribution = "common_lib",
    python_tag = "py3",
    version = "$(VERSION)",
    deps = [":lib"] + INT_DEPS + EXT_DEPS,
    requires = REQUIRES,
    tags = ["manual"],
)
